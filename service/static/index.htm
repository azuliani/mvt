<!DOCTYPE html>
<html>
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
 
<title>WebSockets Client</title>
 
<script>
var loc = window.location
console.log(loc);
var socket = new WebSocket("ws://" + loc.hostname + ":" + loc.port + "/pushupdates");
socket.onopen = function(){
    socket.send("test");
}

var pingTimeout;

function refreshPing(){
    if (pingTimeout){
        clearTimeout(pingTimeout);
    }
    pingTimeout = setTimeout(function(){
        location.reload()
    },5000); 
}

socket.onmessage = function(msg){
    var obj = JSON.parse(msg.data);
    console.log(obj)
    if (obj.totalpushes || obj.totalpushes === 0){
        $('#pushes').text(obj.totalpushes);
    }
    if (obj.ping) {
        refreshPing();
    }

}
</script>

</head>
<body>
<div id="wrapper">
 
    <div id="container">
 
        <h1>Totaal # drukken op de knop:</h1>
    
        <span id="pushes" style="font-size: 230pt">?</span>
        
 
    </div><!-- #container -->
 
</div>
</body>
</html>
